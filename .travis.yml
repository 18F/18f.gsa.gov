language: ruby
rvm:
  - 2.2.0

sudo: false
git:
  submodules: false
  
before_script:
  - npm i -g http-server pa11y pa11y-reporter-ci

script: 
  - ./go ci_build
  - nohup http-server _site/ -p 8080 >/dev/null 2>&1 &
  - pa11y localhost:8080 -r ci -s WCAG2AAA
  - pa11y localhost:8080/tags/18F/ -r ci -s WCAG2AAA
  - pa11y localhost:8080/2015/04/09/flexibility-when-releasing-a-new-product-peace-corps-new-donation-platform/ -r ci -s WCAG2AAA
  - pa11y localhost:8080/news/ -r ci -s WCAG2AAA

notifications:
  email:
    recipients:
      - eric.mill@gsa.gov
      - hillary.hartley@gsa.gov
      - gregory.boone@gsa.gov
    on_success: change
    on_failure: change

branches:
  only:
    - staging
    - production
