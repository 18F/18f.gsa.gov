language: ruby
rvm:
  - 2.2.0

sudo: false
git:
  submodules: false
  
before_script:
  - npm install -g http-server
  - npm install -g pa11y
  - npm install -g pa11y-reporter-ci

script: 
  - ./go ci_build
  - nohup http-server -p 8080 >/dev/null 2>&1 &
  - for i in _site/**/*.html; do echo Scanning $i;pa11y localhost:8080/$i -r ci -s Section508; done

notifications:
  email:
    recipients:
      - eric.mill@gsa.gov
      - hillary.hartley@gsa.gov
      - gregory.boone@gsa.gov
    on_success: change
    on_failure: change

branches:
  only:
    - staging
    - production
